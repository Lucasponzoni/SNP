<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Tickets SNP · Novogar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- FAVICON (cambiá la ruta por tu ico real) -->
  <link rel="icon" href="favicon.ico" type="image/x-icon" />

  <!-- Bootstrap + Bootstrap Icons -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    rel="stylesheet"
  />

  <!-- Estilos propios -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Splash / bienvenida -->
  <div id="splash" class="splash">
    <div class="splash-inner text-center">
      <img
        src="https://i.postimg.cc/MpgSGZkv/Novogar-N.png"
        alt="Novogar"
        class="splash-logo mb-3"
      />
      <h1 class="splash-title mb-2">Bienvenido a Tickets SNP</h1>
      <p class="splash-subtitle mb-3">Cargando panel de reclamos…</p>
      <div class="splash-spinner"></div>
    </div>
  </div>

  <div class="app-shell" id="app-shell">
    <div class="window mx-auto">
      <header
        class="window-header d-flex align-items-center justify-content-between"
      >
        <div class="window-header-left d-flex align-items-center gap-3">
          <div class="window-dots">
            <span class="dot dot-red"></span>
            <span class="dot dot-yellow"></span>
            <span class="dot dot-green"></span>
          </div>
          <div class="window-title">
            <img
              src="https://i.postimg.cc/MpgSGZkv/Novogar-N.png"
              alt="Novogar"
              class="window-logo"
            />
            <div class="window-title-text">
              <h1>
                <i class="bi bi-ticket-detailed me-1"></i>
                SNP. Novogar
              </h1>
              <p>Formulario de tickets de posventa</p>
            </div>
          </div>
        </div>

        <nav class="window-nav">
          <button
            type="button"
            id="nav-new-ticket"
            class="window-nav-btn active"
          >
            <i class="bi bi-plus-circle me-1"></i>
            Nuevo ticket
          </button>
          <button
            type="button"
            id="nav-history"
            class="window-nav-btn"
          >
            <i class="bi bi-journal-text me-1"></i>
            Historial
          </button>
        </nav>
      </header>

      <main class="window-body">
        <!-- Vista: formulario -->
        <section id="view-form" class="view active">
          <form id="snp-form" class="form">
            <div class="form-row">
              <label for="sucursal">Sucursal</label>
              <select
                id="sucursal"
                name="sucursal"
                class="form-select"
                required
              >
                <option value="">Seleccioná una sucursal…</option>

                <option
                  value="WEB NOVOGAR"
                  data-gerente-email="mauricio.daffonchio@novogar.com.ar"
                  data-gerente-nombre="Mauricio Daffonchio"
                >
                  Novogar ROSARIO - WEB NOVOGAR
                </option>

                <option
                  value="Novogar ROSARIO - ECHESORTU"
                  data-gerente-email="leonardo.ferreyra@novogar.com.ar"
                  data-gerente-nombre="Leonardo Ferreyra"
                >
                  Novogar ROSARIO - ECHESORTU
                </option>

                <option
                  value="Novogar ARROYO SECO"
                  data-gerente-email="noelia.diluca@novogar.com.ar"
                  data-gerente-nombre="Noelia Di Luca"
                >
                  Novogar ARROYO SECO
                </option>

                <option
                  value="Novogar VILLA GOBERNADOR GALVEZ"
                  data-gerente-email="matias.yulita@novogar.com.ar"
                  data-gerente-nombre="Matías Yulita"
                >
                  Novogar VILLA GOBERNADOR GALVEZ
                </option>

                <option
                  value="Novogar ROSARIO - ARIJÓN"
                  data-gerente-email="alejandro.asquini@novogar.com.ar"
                  data-gerente-nombre="Alejandro Asquini"
                >
                  Novogar ROSARIO - ARIJÓN
                </option>

                <option
                  value="Novogar ROSARIO - PEATONAL"
                  data-gerente-email="diego.pezzillo@novogar.com.ar"
                  data-gerente-nombre="Diego Pezzillo"
                >
                  Novogar ROSARIO - PEATONAL
                </option>

                <option
                  value="Novogar SAN LORENZO"
                  data-gerente-email="luciano.acosta@novogar.com.ar"
                  data-gerente-nombre="Luciano Acosta"
                >
                  Novogar SAN LORENZO
                </option>

                <option
                  value="Novogar RAFAELA"
                  data-gerente-email="nicolas.mora@novogar.com.ar"
                  data-gerente-nombre="Nicolás Mora"
                >
                  Novogar RAFAELA
                </option>

                <option
                  value="Novogar ALVEAR"
                  data-gerente-email="renzo.matteti@novogar.com.ar"
                  data-gerente-nombre="Renzo Matteti"
                >
                  Novogar ALVEAR
                </option>

                <option
                  value="Novogar ROSARIO - SAN MARTIN"
                  data-gerente-email="esperanza.toffalo@novogar.com.ar"
                  data-gerente-nombre="Esperanza Toffalo"
                >
                  Novogar ROSARIO - SAN MARTIN
                </option>

                <option
                  value="Novogar GRANADERO BAIGORRIA"
                  data-gerente-email="juan.pino@novogar.com.ar"
                  data-gerente-nombre="Juan Pino"
                >
                  Novogar GRANADERO BAIGORRIA
                </option>

                <option
                  value="Novogar CUTRAL CÓ"
                  data-gerente-email="gino.diocares@novogar.com.ar"
                  data-gerente-nombre="Gino Diocares"
                >
                  Novogar CUTRAL CÓ
                </option>

                <option
                  value="Novogar ZAPALA"
                  data-gerente-email="pedro.frias@novogar.com.ar"
                  data-gerente-nombre="Pedro Frías"
                >
                  Novogar ZAPALA
                </option>

                <option
                  value="Novogar NEUQUÉN"
                  data-gerente-email="yamil.flores@novogar.com.ar"
                  data-gerente-nombre="Yamil Flores"
                >
                  Novogar NEUQUÉN
                </option>

                <option
                  value="Novogar CIPOLLETTI"
                  data-gerente-email="antonella.uriarte@novogar.com.ar"
                  data-gerente-nombre="Antonella Uriarte"
                >
                  Novogar CIPOLLETTI
                </option>

                <option
                  value="Novogar SAN JUSTO - BS AS"
                  data-gerente-email="fabricio.dambrosio@novogar.com.ar"
                  data-gerente-nombre="Fabricio Dambrosio"
                >
                  Novogar SAN JUSTO - BS AS
                </option>
              </select>
            </div>

            <div class="form-row">
              <label for="cliente">Cliente</label>
              <input
                type="text"
                id="cliente"
                name="cliente"
                class="form-control uppercase-input"
                placeholder="Nombre y apellido del cliente"
                autocomplete="name"
                required
              />
            </div>

            <div class="form-row">
              <label for="direccion">Dirección</label>
              <input
                type="text"
                id="direccion"
                name="direccion"
                class="form-control uppercase-input"
                placeholder="Dirección del cliente"
                autocomplete="street-address"
                required
              />
            </div>

            <!-- Ciudad / Localidad con autocomplete -->
            <div class="form-row">
              <label for="ciudad">Ciudad / Localidad</label>

              <div class="product-input-wrapper city-input-wrapper">
                <input
                  type="text"
                  id="ciudad"
                  name="ciudad"
                  class="form-control uppercase-input city-input"
                  placeholder="Buscá por CP o localidad (ej: 5000 o CÓRDOBA)"
                  autocomplete="off"
                  required
                />
                <ul
                  id="ciudad-suggestions"
                  class="suggestions hidden list-unstyled city-suggestions"
                ></ul>
              </div>

              <small class="hint">
                Escribí un <b>CP</b> o el nombre de la <b>localidad</b> y seleccioná una sugerencia.
              </small>

              <!-- (Opcional pero recomendado) campos ocultos para guardar la selección “limpia” -->
              <input type="hidden" id="ciudadId" name="ciudadId" />
              <input type="hidden" id="ciudadCp" name="ciudadCp" />
              <input type="hidden" id="ciudadLocalidad" name="ciudadLocalidad" />
              <input type="hidden" id="ciudadProvincia" name="ciudadProvincia" />
            </div>

            <div class="form-row">
              <label for="telefono">Teléfono</label>
              <input
                type="tel"
                id="telefono"
                name="telefono"
                class="form-control"
                placeholder="Teléfono de contacto"
                autocomplete="tel"
                required
              />
            </div>

            <div class="form-row">
              <label for="nroCliente">Número de cliente</label>
              <input
                type="text"
                id="nroCliente"
                name="nroCliente"
                class="form-control"
                placeholder="Número de cliente (si aplica)"
                required
              />
            </div>

            <div class="form-row">
              <label for="fechaCompra">Fecha de compra</label>
              <input
                type="date"
                id="fechaCompra"
                name="fechaCompra"
                class="form-control"
                required
              />
            </div>

            <!-- Bloque de SKUs múltiples -->
            <div class="form-row product-row full">
              <div class="sku-header">
                <label>Productos (SKU)</label>
                <button
                  type="button"
                  id="add-sku-btn"
                  class="btn btn-xs btn-outline-secondary-macos"
                >
                  <i class="bi bi-plus-circle me-1"></i>
                  Agregar SKU
                </button>
              </div>

              <small class="hint">
                Los SKU se cargan de a uno. Usá <b>“Agregar SKU”</b> para sumar más productos.
                A partir de 3 dígitos se muestran sugerencias.
              </small>

              <div id="sku-list" class="sku-list">
                <!-- Los ítems SKU se crean dinámicamente desde app.js -->
              </div>
            </div>

            <div
              id="form-status"
              class="form-status full"
              aria-live="polite"
            ></div>

            <!-- Cartel para imprimir comprobante -->
            <div
              id="print-ticket-banner"
              class="print-banner hidden"
            >
              <div class="print-banner-inner">
                <div class="print-banner-icon">
                  <i class="bi bi-printer-fill"></i>
                </div>
                <div class="print-banner-text">
                  <strong>Ticket generado correctamente</strong>
                  <span>
                    Hacé clic en <b>“Imprimir comprobante”</b> para generar el PDF A4.
                  </span>
                </div>
                <button
                  type="button"
                  id="print-ticket-btn"
                  class="btn btn-sm btn-outline-primary-macos"
                >
                  <i class="bi bi-printer me-1"></i>
                  Imprimir comprobante
                </button>
              </div>
            </div>

            <button
              type="submit"
              id="submit-btn"
              class="btn btn-primary btn-primary-macos"
            >
              <span class="btn-content">
                <span class="btn-label">
                  <i class="bi bi-send me-1"></i>
                  Enviar ticket
                </span>
                <span class="btn-spinner" aria-hidden="true"></span>
              </span>
            </button>
          </form>
        </section>

        <!-- Vista: historial de tickets -->
        <section id="view-history" class="view">
          <div class="history-header d-flex align-items-center justify-content-between mb-3">
            <div>
              <h2 class="history-title mb-1">
                <i class="bi bi-journal-text me-1"></i>
                Historial de tickets
              </h2>
              <p class="history-subtitle mb-0">
                Consultá el historial y reimprimí comprobantes de tickets SNP.
              </p>
            </div>
            <button
              type="button"
              id="refresh-history-btn"
              class="btn btn-sm btn-outline-secondary-macos"
            >
              <i class="bi bi-arrow-clockwise me-1"></i>
              Actualizar
            </button>
          </div>

          <div class="history-search mb-3">
            <div class="input-group input-group-sm">
              <span class="input-group-text">
                <i class="bi bi-search"></i>
              </span>
              <input
                type="search"
                id="history-search-input"
                class="form-control"
                placeholder="Buscar por sucursal, cliente, número de ticket, producto, teléfono, fecha de compra o falla…"
              />
            </div>
          </div>

          <div id="history-list" class="history-list"></div>

          <div
            id="history-empty"
            class="history-empty text-center py-4 d-none"
          >
            <p class="mb-1">No se encontraron tickets.</p>
            <small class="text-muted">
              Probá cambiando el texto de búsqueda o actualizá el historial.
            </small>
          </div>

          <div
            class="history-pagination d-flex justify-content-between align-items-center mt-3"
          >
            <button
              type="button"
              class="btn btn-sm btn-outline-secondary-macos"
              id="history-prev-btn"
            >
              <i class="bi bi-chevron-left"></i>
              Anterior
            </button>
            <div class="history-page-indicator">
              Página <span id="history-page-current">1</span> de
              <span id="history-page-total">1</span>
            </div>
            <button
              type="button"
              class="btn btn-sm btn-outline-secondary-macos"
              id="history-next-btn"
            >
              Siguiente
              <i class="bi bi-chevron-right"></i>
            </button>
          </div>
        </section>
      </main>
    </div>

    <!-- Toast -->
    <div id="global-toast" class="toast-macos hidden">
      <div class="toast-icon">
        <i class="bi bi-check-circle-fill"></i>
      </div>
      <div class="toast-content">
        <strong>Ticket enviado</strong>
        <span>Se guardó en SNP y se enviaron las notificaciones.</span>
      </div>
    </div>

    <!-- Overlay de envío -->
    <div id="overlay-loading" class="overlay hidden">
      <div class="overlay-card">
        <div class="overlay-spinner"></div>
        <p id="overlay-main-text" class="mb-2">Enviando ticket…</p>
        <ul
          id="overlay-steps"
          class="overlay-steps list-unstyled"
        ></ul>
      </div>
    </div>
  </div>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    defer
  ></script>

  <!-- jsPDF para generar los comprobantes en PDF -->
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
    integrity="sha512-qZvrmS2ekKPF2mSznTQsxqPgnpkI4DNTlrdUmTzrDgektczlKNRRhy5X5AAOnx5S09ydFYWWNSfcEqDTTHgtNA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
    defer
  ></script>

  <!-- SweetAlert2 -->
  <script
    src="https://cdn.jsdelivr.net/npm/sweetalert2@11"
    defer
  ></script>

  <script src="ciudades.js" defer></script>

  <!-- Tu lógica principal -->
  <script src="app.js" defer></script>
</body>
</html>